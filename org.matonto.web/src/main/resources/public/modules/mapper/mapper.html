<!-- put-new-file-name-here.html -->
<div class="mapper clearfix" ng-controller="MapperController as vm">

    <div class="row">
        <!-- navigation structure -->
        <aside class="col-md-3 col-sm-4 col-xs-6">
            <div class="boxed list">
                <!-- dataset list -->
                <div class="form-group">
                    <label class="control-label" for="datasets">DataSet</label>
                    <select class="form-control"  id="datasets" name="datasets" ng-model="vm.selected" ng-change="vm.updateDataSetSelection();">
                        <option value="default">Please select a DataSet</option>
                        <option ng-repeat="item in vm.dataSets" value="{{$index}}">{{item.name}}</option>
                        <option value="new">Add a new DataSet</option>
                    </select>
                </div>
                <!-- mapping list -->
                <div class="form-group">
                    <label class="control-label" for="mappings" ng-class="{'text-muted': vm.selected == 'default'}">Class Mapping</label>
                    <select class="form-control"  id="mappings" name="mappings" ng-model="vm.mapping" ng-disabled="vm.selected == 'default'" ng-change="vm.updateMappingSelection();">
                        <option value="default">Please select a Class Mapping</option>
                        <option ng-repeat="item in vm.dataSets[vm.selected].mappings" value="{{$index}}">{{item.name}}</option>
                        <option value="new">Add a new class mapping</option>
                    </select>
                </div>
                <!-- mapping form -->
                <form ng-show="vm.mapping != 'default' && vm.mapping != 'new'">
                    <!-- add new data property -->
                    <strong>Data Properties</strong>
                    <table class="table table-bordered" ng-show="vm.dataSets[vm.selected].mappings[vm.mapping].mapping['delim:dataProperty'].length">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Column</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="property in vm.dataSets[vm.selected].mappings[vm.mapping].mapping['delim:dataProperty']">
                                <td>{{property['@id']}}</td>
                                <td>{{property.temp['delim:columnIndex']}}</td>
                            </tr>
                        </tbody>
                    </table>
                    <a type="button" class="btn btn-link btn-block" ng-click="vm.initProperty('delim:dataProperty');">
                        <i class="fa fa-plus fa-fw"></i>New Data Property
                    </a>
                    <!-- add new object property -->
                    <strong>Object Properties</strong>
                    <table class="table table-bordered" ng-show="vm.dataSets[vm.selected].mappings[vm.mapping].mapping['delim:objectProperty'].length">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Class Mapping</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="property in vm.dataSets[vm.selected].mappings[vm.mapping].mapping['delim:objectProperty']">
                                <td>{{property['@id']}}</td>
                                <td>{{property.temp['delim:classMapping']}}</td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- add new object property -->
                    <a type="button" class="btn btn-link btn-block" ng-click="vm.initProperty('delim:objectProperty');">
                        <i class="fa fa-plus fa-fw"></i>New Object Property
                    </a>
                </form>
            </div>
        </aside>

        <!-- dataset viewer -->
        <section class="col-md-9 col-sm-8 col-xs-6">
            <div class="boxed viewer">
                <!-- default -->
                <div ng-show="vm.selected == 'default' || vm.selected == 'new'" class="default">
                    <p class="lead">Welcome to the DataSet Mapper!</p>
                    <p>Click an item in the left pane to get started. This pane will then update accordingly.</p>
                </div>
                <!-- dataset viewer -->
                <table ng-show="vm.selected != undefined" class="table">
                    <thead>
                        <tr>
                            <th ng-repeat="(key, value) in vm.dataSets[vm.selected].dataSet[0]">{{key}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="row in vm.dataSets[vm.selected].dataSet">
                            <td ng-repeat="(key, value) in row">{{value}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- add dataset overlay -->
    <div class="overlay sm" ng-show="vm.showDataSetOverlay">
        <!-- content container -->
        <form class="content clearfix">
            <h6>New Dataset</h6>
            <!-- name -->
            <div class="form-group">
                <label for="dataset-name">Name</label>
                <input type="text" class="form-control" id="dataset-name" ng-model="vm.dataSetName">
            </div>
            <!-- file -->
            <div class="form-group">
                <label for="source">Source file</label>
                <div id="source" file-input="vm.file" on-change="vm.readFile()"></div>
            </div>
            <!-- buttons -->
            <div class="btn-container clearfix">
                <button type="submit" class="btn btn-primary pull-right" ng-click="vm.addDataSet();" ng-disabled="!vm.file || !vm.dataSetName">Add</button>
                <button type="button" class="btn btn-default pull-right" ng-click="vm.cancelDataSet();">Cancel</button>
            </div>
        </form>
    </div>

    <!-- add mapping overlay -->
    <div class="overlay sm" ng-show="vm.showMappingOverlay">
        <!-- content container -->
        <form class="content clearfix" name="vm.mappingForm">
            <h6>New Class Mapping</h6>
            <!-- name -->
            <div class="form-group">
                <label for="mapping-name">Name</label>
                <input type="text" class="form-control" id="mapping-name" ng-model="vm.mappingName" required>
            </div>
            <!-- delim:hasPrefix -->
            <div class="form-group">
                <label for="hasPrefix">Prefix</label>
                <input type="text" class="form-control" id="hasPrefix" ng-model="vm.new['delim:hasPrefix']" required>
            </div>
            <!-- delim:localName -->
            <div class="form-group">
                <label for="localName">Local Name</label>
                <input type="text" class="form-control" id="localName" ng-model="vm.new['delim:localName']" required>
            </div>
            <!-- delim:mapsTo -->
            <div class="form-group">
                <label for="mapsTo">Maps To</label>
                <input type="text" class="form-control" id="mapsTo" ng-model="vm.new['delim:mapsTo']" required>
            </div>
            <!-- buttons -->
            <div class="btn-container clearfix">
                <button type="submit" class="btn btn-primary pull-right" ng-click="vm.addMapping();" ng-disabled="vm.mappingForm.$invalid">Add</button>
                <button type="button" class="btn btn-default pull-right" ng-click="vm.cancelMapping();">Cancel</button>
            </div>
        </form>
    </div>

    <!-- add property overlay -->
    <div class="overlay sm" ng-show="vm.showPropertyOverlay">
        <!-- content container -->
        <form class="content clearfix" name="vm.form" novalidate>
            <h6>New Class Mapping Property</h6>
            <!-- type -->
            <!--div class="form-group">
                <label class="control-label" for="type">Type</label>
                <select class="form-control"  id="type" name="type" ng-model="vm.new.type" ng-change="vm.clearNew();">
                    <option value="default">Please select a Type</option>
                    <option value="delim:dataProperty">Data Property</option>
                    <option value="delim:objectProperty">Object Property</option>
                </select>
            </div-->

            <!-- data property -->
            <div ng-show="vm.new.type == 'delim:dataProperty'">
                <!-- name -->
                <div class="form-group">
                    <label for="property-name">URI (for this property)</label>
                    <input type="text" class="form-control" id="property-name" ng-model="vm.new.name" ng-required="vm.new.type == 'delim:dataProperty'">
                </div>
                <!-- column -->
                <div class="form-group">
                    <label for="column-index">Column (starts at 1 from the left)</label>
                    <select class="form-control" id="column-index" name="column" ng-model="vm.new['delim:columnIndex']" ng-required="vm.new.type == 'delim:dataProperty'" ng-pattern="/^(?!^default$).*$/">
                        <option value="default">Please select a column</option>
                        <option ng-repeat="(key, value) in vm.dataSets[vm.selected].dataSet[0]" value="{{$index + 1}}">{{$index + 1}} - {{key}}</option>
                    </select>
                </div>
                <!-- has property -->
                <div class="form-group">
                    <label for="has-property">URI (property from ontology)</label>
                    <input type="text" class="form-control" id="has-property" ng-model="vm.new['delim:hasProperty']['@id']" ng-required="vm.new.type == 'delim:dataProperty'">
                </div>
            </div>

            <!-- object property -->
            <div ng-show="vm.new.type == 'delim:objectProperty'">
                <!-- name -->
                <div class="form-group">
                    <label for="object-name">URI (for this property)</label>
                    <input type="text" class="form-control" id="object-name" ng-model="vm.new.name" ng-required="vm.new.type == 'delim:objectProperty'">
                </div>
                <!-- class mapping -->
                <div class="form-group">
                    <label for="class-mapping">Class (another class mapping)</label>
                    <select class="form-control"  id="class-mapping" name="class-mapping" ng-model="vm.new['delim:classMapping']" ng-required="vm.new.type == 'delim:objectProperty'" ng-pattern="/^(?!^default$).*$/">
                        <option value="default">Please select a Class Mapping</option>
                        <option ng-repeat="item in vm.dataSets[vm.selected].mappings" value="{{item.name}}" ng-show="item.mapping['@id'] != vm.dataSets[vm.selected].mappings[vm.mapping].mapping['@id']">{{item.name}}</option>
                    </select>
                </div>
                <!-- has property -->
                <div class="form-group">
                    <label for="has-property">URI (ontology)</label>
                    <input type="text" class="form-control" id="has-property" ng-model="vm.new['delim:hasProperty']['@id']" ng-required="vm.new.type == 'delim:objectProperty'">
                </div>
            </div>

            <!-- default buttons -->
            <div class="btn-container clearfix">
                <button type="submit" class="btn btn-primary pull-right" ng-show="vm.new.type != 'default'" ng-click="vm.addProperty();" ng-disabled="vm.form.$invalid">Add</button>
                <button type="button" class="btn btn-default pull-right" ng-click="vm.cancelProperty();">Cancel</button>
                <div class="checkbox pull-right">
                    <label>
                        <input type="checkbox" ng-model="vm.another" />Add another?
                    </label>
                </div>
            </div>

        </form>
    </div>

    <!--pre>{{vm.new | json}}</pre>
    <pre>{{vm.dataSets[vm.selected].mappings[vm.mapping].mapping | json}}</pre>
    <pre>{{vm.dataSets[vm.selected].mappings | json}}</pre-->
</div>
