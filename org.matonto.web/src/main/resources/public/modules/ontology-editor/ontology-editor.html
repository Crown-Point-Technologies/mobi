<!-- inner property template -->
<script type="text/ng-template" id="property-template">
    <a ng-click="vm.selectItem('property-editor', oi, ci, $index)"
       ng-class="{'unsaved': property.matonto.unsaved, 'active': vm.state.oi === oi && vm.state.ci === ci && vm.state.pi === $index}">
        <i class="fa fa-fw {{property.matonto.icon}}"
        ></i>{{property[ontology.matonto.rdfs + 'label'][0]['@value'] || ((property['@id'] | splitIRI).end | beautify)}}
        <i ng-show="property.matonto.unsaved" class="fa fa-exclamation unsaved-icon pull-right"></i>
    </a>
</script>

<!-- object property template -->
<script type="text/ng-template" id="object-property-template">
    <li ng-repeat="property in properties" ng-if="vm.typeMatch(property, ontology.matonto.owl, 'ObjectProperty')" ng-include="'property-template'"></li>
</script>

<!-- datatype property template -->
<script type="text/ng-template" id="datatype-property-template">
    <li ng-repeat="property in properties" ng-if="vm.typeMatch(property, ontology.matonto.owl, 'DataTypeProperty') || vm.typeMatch(property, ontology.matonto.owl, 'DatatypeProperty')" ng-include="'property-template'"></li>
</script>

<!-- ontology-editor.html -->
<div class="ontology-editor clearfix" ng-controller="OntologyEditorController as vm">
    <div class="row">
        <!-- navigation structure -->
        <aside class="col-xs-4">
            <div class="tree-container boxed">
                <!-- tab view -->
                <div class="btn-group btn-group-justified" role="group">
                    <!-- everything tree tab -->
                    <a class="btn btn-primary"
                       ng-class="{'active': vm.state.tab === 'everything'}"
                       ng-click="vm.setTreeTab('everything');"><small>Tree</small></a>

                    <!-- class tree tab -->
                    <a class="btn btn-primary"
                       ng-class="{'active': vm.state.tab === 'class'}"
                       ng-click="vm.setTreeTab('class');"><small>Class</small></a>

                    <!-- object property tree tab -->
                    <a class="btn btn-primary"
                       ng-class="{'active': vm.state.tab === 'object'}"
                       ng-click="vm.setTreeTab('object');"><small>Object</small></a>

                    <!-- datatype property tree tab -->
                    <a class="btn btn-primary"
                       ng-class="{'active': vm.state.tab === 'datatype'}"
                       ng-click="vm.setTreeTab('datatype');"><small>Data</small></a>
                </div>

                <!-- tree showing ontologies, classes, and properties -->
                <div ng-if="vm.state.tab === 'everything'" class="tree everything-tree scroll-without-buttons">
                    <!-- tree view -->
                    <strong>Everything</strong>
                    <!-- start ontologies -->
                    <ul ng-repeat="(oi, ontology) in vm.ontologies" ng-init="opened = (vm.state.oi === oi && vm.state.ci !== undefined)">
                        <li>
                            <a ng-click="vm.selectItem('ontology-editor', $index)"
                               ng-class="{'unsaved': ontology.matonto.unsaved, 'active': vm.state.oi === $index && vm.state.ci === undefined && vm.state.pi === undefined}">
                                <i class="fa fa-fw"
                                   ng-class="{'fa-minus-square-o': opened, 'fa-plus-square-o': !opened}"
                                   ng-click="opened = !opened; $event.stopPropagation();"
                                ></i>{{ontology[ontology.matonto.rdfs + 'label'][0]['@value'] || ((ontology['@id'] | splitIRI).end | beautify)}}
                                <i ng-show="ontology.matonto.unsaved" class="fa fa-exclamation unsaved-icon pull-right"></i>
                            </a>
                        </li>
                        <li class="container" ng-show="opened">
                            <!-- start classes -->
                            <ul ng-repeat="(ci, class) in ontology.matonto.classes" ng-init="subOpened = (vm.state.ci === ci && vm.state.pi !== undefined)">
                                <li>
                                    <a ng-click="vm.selectItem('class-editor', oi, $index)"
                                       ng-class="{'unsaved': class.matonto.unsaved, 'active': vm.state.oi === oi && vm.state.ci === $index && vm.state.pi === undefined}">
                                        <i class="fa fa-fw"
                                           ng-class="{'fa-minus-square-o': subOpened, 'fa-plus-square-o': !subOpened}"
                                           ng-click="subOpened = !subOpened; $event.stopPropagation();"
                                        ></i>{{class[ontology.matonto.rdfs + 'label'][0]['@value'] || ((class['@id'] | splitIRI).end | beautify)}}
                                        <i ng-show="class.matonto.unsaved" class="fa fa-exclamation unsaved-icon pull-right"></i>
                                    </a>
                                </li>
                                <li class="container" ng-show="subOpened">
                                    <!-- start properties -->
                                    <ul>
                                        <li ng-repeat="property in class.matonto.properties" ng-include="'property-template'"></li>
                                    </ul>
                                    <!-- create a new property -->
                                    <div class="creator">
                                        <a ng-click="vm.selectItem('property-editor', oi, ci, -1)"
                                           ng-class="{'active': vm.state.oi === oi && vm.state.ci === ci && vm.state.pi === -1}">
                                            <i class="fa fa-plus fa-fw"></i>New Property
                                        </a>
                                    </div>
                                    <!-- end properties -->
                                </li>
                            </ul>
                            <div class="creator">
                                <a ng-click="vm.selectItem('class-editor', oi, -1)"
                                   ng-class="{'active': vm.state.oi === oi && vm.state.ci === -1}">
                                    <i class="fa fa-plus fa-fw"></i>New Class
                                </a>
                            </div>
                            <!-- end classes -->

                            <!-- start no domains -->
                            <ul ng-if="ontology.matonto.noDomains.length">
                                <li>
                                    <a ng-click="noDomains = !noDomains; $event.stopPropagation();">
                                        <i class="fa fa-fw"
                                           ng-class="{'fa-folder-open-o': noDomains, 'fa-folder-o': !noDomains}"></i>Properties
                                    </a>
                                </li>
                                <!-- properties without domains -->
                                <li class="container" ng-show="noDomains">
                                    <ul>
                                        <li ng-repeat="property in ontology.matonto.noDomains" ng-include="'property-template'"></li>
                                    </ul>
                                </li>
                            </ul>
                            <!-- end no domains -->

                            <!-- start others -->
                            <ul ng-if="ontology.matonto.others.length">
                                <li>
                                    <a ng-click="theOthers = !theOthers; $event.stopPropagation();">
                                        <i class="fa fa-fw"
                                           ng-class="{'fa-folder-open-o': theOthers, 'fa-folder-o': !theOthers}"></i>Others
                                    </a>
                                </li>
                                <li class="container" ng-show="theOthers">
                                    <ul ng-repeat="other in ontology.matonto.others">
                                        <a>
                                            <i class="fa fa-fw fa-question"></i>{{other[ontology.matonto.rdfs + 'label'][0]['@value'] || ((other['@id'] | splitIRI).end | beautify)}}
                                        </a>
                                    </ul>
                                </li>
                            </ul>
                            <!-- end others -->
                        </li>
                    </ul>
                    <div class="creator">
                        <a ng-click="vm.selectItem('ontology-editor', -1)"
                           ng-class="{'active': vm.state.oi === -1}">
                            <i class="fa fa-plus fa-fw"></i>Create New Ontology
                        </a>
                        <a ng-click="vm.showUploadOverlay = true;"
                           ng-class="{'active': vm.showUploadOverlay}">
                            <i class="fa fa-upload fa-fw"></i>Upload Ontology
                        </a>
                        <a ng-click="vm.deleteOntology();"
                           ng-class="{'disabled': vm.state.editor !== 'ontology-editor' || vm.state.oi === -1}">
                            <i class="fa fa-trash-o fa-fw"></i>Delete Ontology
                        </a>
                    </div>
                    <!-- end ontologies -->
                </div>

                <!-- tree showing classes -->
                <div ng-if="vm.state.tab === 'class'" class="tree class-tree scroll-without-buttons">
                    <!-- class view -->
                    <strong>Classes</strong>
                    <ul ng-repeat="(oi, ontology) in vm.ontologies" ng-init="opened = (vm.state.oi === oi)">
                        <li>
                            <a ng-click="opened = !opened; $event.stopPropagation();">
                                <i class="fa fa-fw"
                                   ng-class="{'fa-minus-square-o': opened, 'fa-plus-square-o': !opened}"
                                        ></i>{{ontology[ontology.matonto.rdfs + 'label'][0]['@value'] || ((ontology['@id'] | splitIRI).end | beautify)}}
                            </a>
                        </li>
                        <li class="container" ng-show="opened">
                            <ul>
                                <li ng-repeat="class in ontology.matonto.classes">
                                    <a class="text-only"
                                       ng-click="vm.selectItem('class-editor', oi, $index)"
                                       ng-class="{'unsaved': class.matonto.unsaved, 'active': vm.state.oi === oi && vm.state.ci === $index && vm.state.pi === undefined}">
                                        {{class[ontology.matonto.rdfs + 'label'][0]['@value'] || ((class['@id'] | splitIRI).end | beautify)}}
                                        <i ng-show="class.matonto.unsaved" class="fa fa-exclamation unsaved-icon pull-right"></i>
                                    </a>
                                </li>
                            </ul>
                            <div class="creator">
                                <a ng-click="vm.selectItem('class-editor', oi, -1)"
                                   ng-class="{'active': vm.state.oi === oi && vm.state.ci === -1}">
                                    <i class="fa fa-plus fa-fw"></i>New Class
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- tree showing object properties -->
                <div ng-if="vm.state.tab === 'object'" class="tree object-tree scroll-without-buttons">
                    <!-- property view -->
                    <strong>Object Properties</strong>
                    <ul ng-repeat="(oi, ontology) in vm.ontologies" ng-init="opened = (vm.state.oi === oi)">
                        <li>
                            <a ng-click="opened = !opened; $event.stopPropagation();">
                                <i class="fa fa-fw"
                                   ng-class="{'fa-minus-square-o': opened, 'fa-plus-square-o': !opened}"
                                ></i>{{ontology[ontology.matonto.rdfs + 'label'][0]['@value'] || ((ontology['@id'] | splitIRI).end | beautify)}}
                            </a>
                        </li>
                        <li class="container" ng-show="opened">
                            <!-- properties associated with classes -->
                            <ul ng-repeat="(ci, class) in ontology.matonto.classes" ng-include="'object-property-template'" ng-init="properties = class.matonto.properties"></ul>
                            <!-- properties not associated with classes -->
                            <ul ng-include="'object-property-template'" ng-init="properties = ontology.matonto.noDomains"></ul>
                            <!-- create new object property -->
                            <div class="creator">
                                <a ng-click="vm.selectItem('property-editor', oi, -1, -1)"
                                   ng-class="{'active': vm.state.oi === oi && vm.state.ci === -1 && vm.state.pi === -1}">
                                    <i class="fa fa-plus fa-fw"></i>New Object Property
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- tree showing dataType properties -->
                <div ng-if="vm.state.tab === 'datatype'" class="tree datatype-tree scroll-without-buttons">
                    <!-- property view -->
                    <strong>DataType Properties</strong>
                    <ul ng-repeat="(oi, ontology) in vm.ontologies" ng-init="opened = (vm.state.oi === oi)">
                        <li>
                            <a ng-click="opened = !opened; $event.stopPropagation();">
                                <i class="fa fa-fw"
                                   ng-class="{'fa-minus-square-o': opened, 'fa-plus-square-o': !opened}"
                                ></i>{{ontology[ontology.matonto.rdfs + 'label'][0]['@value'] || ((ontology['@id'] | splitIRI).end | beautify)}}
                            </a>
                        </li>
                        <li class="container" ng-show="opened">
                            <!-- properties associated with classes -->
                            <ul ng-repeat="(ci, class) in ontology.matonto.classes" ng-include="'datatype-property-template'" ng-init="properties = class.matonto.properties"></ul>
                            <!-- properties not associated with classes -->
                            <ul ng-include="'datatype-property-template'" ng-init="properties = ontology.matonto.noDomains;"></ul>
                            <!-- create new datatype property -->
                            <div class="creator">
                                <a ng-click="vm.selectItem('property-editor', oi, -1, -1)"
                                   ng-class="{'active': vm.state['datatype'].selected === 'create-property' && vm.state['datatype'].class === class}">
                                    <i class="fa fa-plus fa-fw"></i>New DataType Property
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </aside>

        <!-- edit/create form section -->
        <section class="col-xs-8">
            <div class="editor boxed">
                <!-- default -->
                <div ng-if="vm.state.editor === 'default'" class="tab default">
                    <p class="lead">Welcome to the Ontology Editor!</p>
                    <p>Click an item in the left pane to get started. This pane will then update accordingly.</p>
                </div>

                <ontology-editor ng-if="vm.state.editor === 'ontology-editor'"></ontology-editor>

                <class-editor ng-if="vm.state.editor === 'class-editor'"></class-editor>

                <property-editor ng-if="vm.state.editor === 'property-editor'"></property-editor>

                <iri-overlay ng-if="vm.showIriOverlay"></iri-overlay>

                <ontology-upload-overlay ng-if="vm.showUploadOverlay"></ontology-upload-overlay>

                <annotation-overlay ng-if="vm.showAnnotationOverlay"></annotation-overlay>
            </div>
        </section>
    </div>
    <pre>{{vm.selected | removeMatonto | json}}</pre>
    <button ng-if="vm.state.editor !== 'default'" type="button" class="btn btn-primary btn-circle" ng-click="vm.submitEdit()"><i class="fa fa-fw fa-floppy-o"></i></button>
</div>
