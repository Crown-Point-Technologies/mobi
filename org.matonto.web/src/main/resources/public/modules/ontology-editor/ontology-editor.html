<!-- inner property template -->
<script type="text/ng-template" id="property-template">
    <a ng-click="vm.selectItem('property-editor', oi, ci, $index)"
       ng-class="{'unsaved': property.matonto.unsaved, 'active': vm.state.oi === oi && vm.state.ci === ci && vm.state.pi === $index}">
        <i class="fa fa-fw {{property.matonto.icon}}"
        ></i>{{property[ontology.matonto.rdfs + 'label'][0]['@value'] || ((property['@id'] | splitIRI).end | beautify)}}
        <i ng-show="property.matonto.unsaved" class="fa fa-exclamation unsaved-icon pull-right"></i>
    </a>
</script>

<!-- object property template -->
<script type="text/ng-template" id="object-property-template">
    <li ng-repeat="property in properties" ng-if="vm.typeMatch(property, ontology.matonto.owl, 'ObjectProperty')" ng-include="'property-template'"></li>
</script>

<!-- datatype property template -->
<script type="text/ng-template" id="datatype-property-template">
    <li ng-repeat="property in properties" ng-if="vm.typeMatch(property, ontology.matonto.owl, 'DataTypeProperty') || vm.typeMatch(property, ontology.matonto.owl, 'DatatypeProperty')" ng-include="'property-template'"></li>
</script>

<!-- ontology-editor.html -->
<div class="ontology-editor clearfix" ng-controller="OntologyEditorController as vm">
    <div class="row">
        <!-- navigation structure -->
        <aside class="col-xs-4">
            <div class="tree-container boxed">
                <!-- tab view -->
                <div class="btn-group btn-group-justified" role="group">
                    <!-- everything tree tab -->
                    <a class="btn btn-primary"
                       ng-class="{'active': vm.state.tab === 'everything'}"
                       ng-click="vm.setTreeTab('everything');"><small>Tree</small></a>

                    <!-- class tree tab -->
                    <a class="btn btn-primary"
                       ng-class="{'active': vm.state.tab === 'class'}"
                       ng-click="vm.setTreeTab('class');"><small>Class</small></a>

                    <!-- object property tree tab -->
                    <a class="btn btn-primary"
                       ng-class="{'active': vm.state.tab === 'object'}"
                       ng-click="vm.setTreeTab('object');"><small>Object</small></a>

                    <!-- datatype property tree tab -->
                    <a class="btn btn-primary"
                       ng-class="{'active': vm.state.tab === 'datatype'}"
                       ng-click="vm.setTreeTab('datatype');"><small>Data</small></a>
                </div>

                <!-- tree showing ontologies, classes, and properties -->
                <div ng-if="vm.state.tab === 'everything'" class="tree everything-tree scroll-without-buttons">
                    <!-- tree view -->
                    <strong>Everything</strong>
                    <!-- start ontologies -->
                    <ul ng-repeat="(oi, ontology) in vm.ontologies" ng-init="opened = (vm.state.oi === oi && vm.state.ci !== undefined)">
                        <li>
                            <a ng-click="vm.selectItem('ontology-editor', $index)"
                               ng-class="{'unsaved': ontology.matonto.unsaved, 'active': vm.state.oi === $index && vm.state.ci === undefined && vm.state.pi === undefined}">
                                <i class="fa fa-fw"
                                   ng-class="{'fa-minus-square-o': opened, 'fa-plus-square-o': !opened}"
                                   ng-click="opened = !opened; $event.stopPropagation();"
                                ></i>{{ontology[ontology.matonto.rdfs + 'label'][0]['@value'] || ((ontology['@id'] | splitIRI).end | beautify)}}
                                <i ng-show="ontology.matonto.unsaved" class="fa fa-exclamation unsaved-icon pull-right"></i>
                            </a>
                        </li>
                        <li class="container" ng-show="opened">
                            <!-- start classes -->
                            <ul ng-repeat="(ci, class) in ontology.matonto.classes" ng-init="subOpened = (vm.state.ci === ci && vm.state.pi !== undefined)">
                                <li>
                                    <a ng-click="vm.selectItem('class-editor', oi, $index)"
                                       ng-class="{'unsaved': class.matonto.unsaved, 'active': vm.state.oi === oi && vm.state.ci === $index && vm.state.pi === undefined}">
                                        <i class="fa fa-fw"
                                           ng-class="{'fa-minus-square-o': subOpened, 'fa-plus-square-o': !subOpened}"
                                           ng-click="subOpened = !subOpened; $event.stopPropagation();"
                                        ></i>{{class[ontology.matonto.rdfs + 'label'][0]['@value'] || ((class['@id'] | splitIRI).end | beautify)}}
                                        <i ng-show="class.matonto.unsaved" class="fa fa-exclamation unsaved-icon pull-right"></i>
                                    </a>
                                </li>
                                <li class="container" ng-show="subOpened">
                                    <!-- start properties -->
                                    <ul>
                                        <li ng-repeat="property in class.matonto.properties" ng-include="'property-template'"></li>
                                    </ul>
                                    <!-- create a new property -->
                                    <div class="creator">
                                        <a ng-click="vm.selectItem('property-editor', oi, ci, -1)"
                                           ng-class="{'active': vm.state.oi === oi && vm.state.ci === ci && vm.state.pi === -1}">
                                            <i class="fa fa-plus fa-fw"></i>New Property
                                        </a>
                                    </div>
                                    <!-- end properties -->
                                </li>
                            </ul>
                            <div class="creator">
                                <a ng-click="vm.selectItem('class-editor', oi, -1)"
                                   ng-class="{'active': vm.state.oi === oi && vm.state.ci === -1}">
                                    <i class="fa fa-plus fa-fw"></i>New Class
                                </a>
                            </div>
                            <!-- end classes -->

                            <!-- start no domains -->
                            <ul ng-if="ontology.matonto.noDomains.length">
                                <li>
                                    <a ng-click="noDomains = !noDomains; $event.stopPropagation();">
                                        <i class="fa fa-fw"
                                           ng-class="{'fa-folder-open-o': noDomains, 'fa-folder-o': !noDomains}"></i>Properties
                                    </a>
                                </li>
                                <!-- properties without domains -->
                                <li class="container" ng-show="noDomains">
                                    <ul>
                                        <li ng-repeat="property in ontology.matonto.noDomains" ng-include="'property-template'"></li>
                                    </ul>
                                </li>
                            </ul>
                            <!-- end no domains -->

                            <!-- start others -->
                            <ul ng-if="ontology.matonto.others.length">
                                <li>
                                    <a ng-click="theOthers = !theOthers; $event.stopPropagation();">
                                        <i class="fa fa-fw"
                                           ng-class="{'fa-folder-open-o': theOthers, 'fa-folder-o': !theOthers}"></i>Others
                                    </a>
                                </li>
                                <li class="container" ng-show="theOthers">
                                    <ul ng-repeat="other in ontology.matonto.others">
                                        <a>
                                            <i class="fa fa-fw fa-question"></i>{{other[ontology.matonto.rdfs + 'label'][0]['@value'] || ((other['@id'] | splitIRI).end | beautify)}}
                                        </a>
                                    </ul>
                                </li>
                            </ul>
                            <!-- end others -->
                        </li>
                    </ul>
                    <div class="creator">
                        <a ng-click="vm.selectItem('ontology-editor', -1)"
                           ng-class="{'active': vm.state.oi === -1}">
                            <i class="fa fa-plus fa-fw"></i>Create New Ontology
                        </a>
                        <a ng-click="vm.showUploadOverlay = true;"
                           ng-class="{'active': vm.showUploadOverlay}">
                            <i class="fa fa-upload fa-fw"></i>Upload Ontology
                        </a>
                        <a ng-click="vm.deleteOntology();"
                           ng-class="{'disabled': vm.state.editor !== 'ontology-editor' || vm.state.oi === -1}">
                            <i class="fa fa-trash-o fa-fw"></i>Delete Ontology
                        </a>
                    </div>
                    <!-- end ontologies -->
                </div>

                <!-- tree showing classes -->
                <div ng-if="vm.state.tab === 'class'" class="tree class-tree scroll-without-buttons">
                    <!-- class view -->
                    <strong>Classes</strong>
                    <ul ng-repeat="(oi, ontology) in vm.ontologies" ng-init="opened = (vm.state.oi === oi)">
                        <li>
                            <a ng-click="opened = !opened; $event.stopPropagation();">
                                <i class="fa fa-fw"
                                   ng-class="{'fa-minus-square-o': opened, 'fa-plus-square-o': !opened}"
                                        ></i>{{ontology[ontology.matonto.rdfs + 'label'][0]['@value'] || ((ontology['@id'] | splitIRI).end | beautify)}}
                            </a>
                        </li>
                        <li class="container" ng-show="opened">
                            <ul>
                                <li ng-repeat="class in ontology.matonto.classes">
                                    <a class="text-only"
                                       ng-click="vm.selectItem('class-editor', oi, $index)"
                                       ng-class="{'unsaved': class.matonto.unsaved, 'active': vm.state.oi === oi && vm.state.ci === $index && vm.state.pi === undefined}">
                                        {{class[ontology.matonto.rdfs + 'label'][0]['@value'] || ((class['@id'] | splitIRI).end | beautify)}}
                                        <i ng-show="class.matonto.unsaved" class="fa fa-exclamation unsaved-icon pull-right"></i>
                                    </a>
                                </li>
                            </ul>
                            <div class="creator">
                                <a ng-click="vm.selectItem('class-editor', oi, -1)"
                                   ng-class="{'active': vm.state.oi === oi && vm.state.ci === -1}">
                                    <i class="fa fa-plus fa-fw"></i>New Class
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- tree showing object properties -->
                <div ng-if="vm.state.tab === 'object'" class="tree object-tree scroll-without-buttons">
                    <!-- property view -->
                    <strong>Object Properties</strong>
                    <ul ng-repeat="(oi, ontology) in vm.ontologies" ng-init="opened = (vm.state.oi === oi)">
                        <li>
                            <a ng-click="opened = !opened; $event.stopPropagation();">
                                <i class="fa fa-fw"
                                   ng-class="{'fa-minus-square-o': opened, 'fa-plus-square-o': !opened}"
                                ></i>{{ontology[ontology.matonto.rdfs + 'label'][0]['@value'] || ((ontology['@id'] | splitIRI).end | beautify)}}
                            </a>
                        </li>
                        <li class="container" ng-show="opened">
                            <!-- properties associated with classes -->
                            <ul ng-repeat="(ci, class) in ontology.matonto.classes" ng-include="'object-property-template'" ng-init="properties = class.matonto.properties"></ul>
                            <!-- properties not associated with classes -->
                            <ul ng-include="'object-property-template'" ng-init="properties = ontology.matonto.noDomains"></ul>
                            <!-- create new object property -->
                            <div class="creator">
                                <a ng-click="vm.selectItem('property-editor', oi, -1, -1)"
                                   ng-class="{'active': vm.state.oi === oi && vm.state.ci === -1 && vm.state.pi === -1}">
                                    <i class="fa fa-plus fa-fw"></i>New Object Property
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- tree showing dataType properties -->
                <div ng-if="vm.state.tab === 'datatype'" class="tree datatype-tree scroll-without-buttons">
                    <!-- property view -->
                    <strong>DataType Properties</strong>
                    <ul ng-repeat="(oi, ontology) in vm.ontologies" ng-init="opened = (vm.state.oi === oi)">
                        <li>
                            <a ng-click="opened = !opened; $event.stopPropagation();">
                                <i class="fa fa-fw"
                                   ng-class="{'fa-minus-square-o': opened, 'fa-plus-square-o': !opened}"
                                ></i>{{ontology[ontology.matonto.rdfs + 'label'][0]['@value'] || ((ontology['@id'] | splitIRI).end | beautify)}}
                            </a>
                        </li>
                        <li class="container" ng-show="opened">
                            <!-- properties associated with classes -->
                            <ul ng-repeat="(ci, class) in ontology.matonto.classes" ng-include="'datatype-property-template'" ng-init="properties = class.matonto.properties"></ul>
                            <!-- properties not associated with classes -->
                            <ul ng-include="'datatype-property-template'" ng-init="properties = ontology.matonto.noDomains;"></ul>
                            <!-- create new datatype property -->
                            <div class="creator">
                                <a ng-click="vm.selectItem('property-editor', oi, -1, -1)"
                                   ng-class="{'active': vm.state['datatype'].selected === 'create-property' && vm.state['datatype'].class === class}">
                                    <i class="fa fa-plus fa-fw"></i>New DataType Property
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </aside>

        <!-- edit/create form section -->
        <section class="col-xs-8">
            <div class="editor boxed">
                <!-- default -->
                <div ng-if="vm.state.editor === 'default'" class="tab default">
                    <p class="lead">Welcome to the Ontology Editor!</p>
                    <p>Click an item in the left pane to get started. This pane will then update accordingly.</p>
                </div>

                <!-- ontology editor -->
                <form name="vm.ontologyForm" class="clearfix" novalidate autocomplete="off"
                      ng-if="vm.state.editor === 'ontology-editor'">

                    <!-- tab toggles -->
                    <div class="btn-group btn-group-justified" role="group">
                        <!-- basic button -->
                        <a class="btn btn-primary"
                           ng-class="{'active': vm.state.editorTab === 'basic'}"
                           ng-click="vm.setEditorTab('basic');"><small>{{vm.state.oi !== -1 ? (vm.selected[vm.rdfs + 'label'][0]['@value'] || ((vm.selected['@id'] | splitIRI).end | beautify)) : 'New Ontology'}}</small></a>

                        <!-- annotations button -->
                        <a class="btn btn-primary"
                           ng-class="{'active': vm.state.editorTab === 'annotations'}"
                           ng-click="vm.setEditorTab('annotations');"><small>Annotations</small></a>

                        <!-- prefix button -->
                        <a class="btn btn-primary"
                           ng-class="{'active': vm.state.editorTab === 'prefix'}"
                           ng-click="vm.setEditorTab('prefix');"><small>Prefix</small></a>
                    </div>

                    <!-- basic tab -->
                    <div ng-show="vm.state.editorTab === 'basic'" class="tab clearfix">
                        <!-- warning message -->
                        <p ng-show="vm.selected.matonto.unsaved" class="text-warning"><i class="fa fa-exclamation-triangle fa-fw"></i>Not saved</p>

                        <!-- IRI -->
                        <div  ng-class="{'has-error': vm.ontologyForm.iri.$invalid}" class="form-group">
                            <label class="control-label" for="ontology-iri">Ontology IRI</label>
                            <input type="text" class="form-control" id="ontology-iri" name="iri" ng-model="vm.selected['@id']" ng-pattern="/^[^:\/?#]+:\/\/[^\/?#]*[^#\s]*[^#:\/\s]$/" required>
                            <!--p class="error-msg" ng-if="vm.ontologyForm.iri.$invalid">This IRI is invalid.</p-->
                        </div>

                        <!-- label -->
                        <div class="form-group">
                            <label class="control-label" for="ontology-label">Label <small class="text-muted">&lt;{{vm.rdfs}}label&gt;</small></label>
                            <input type="text" class="form-control" id="ontology-label" name="label" ng-model="vm.selected[vm.rdfs + 'label'][0]['@value']" ng-trim="false" ng-change="vm.selected.matonto.unsaved = true;">
                        </div>

                        <!-- comments -->
                        <div class="form-group">
                            <label class="control-label" for="ontology-comments">Comment <small class="text-muted">&lt;{{vm.rdfs}}comment&gt;</small></label>
                            <textarea class="form-control" id="ontology-comments" name="comments" ng-model="vm.selected[vm.rdfs + 'comment'][0]['@value']" ng-change="vm.selected.matonto.unsaved = true;"></textarea>
                        </div>

                        <!-- buttons -->
                        <div class="btn-container clearfix">
                            <button ng-if="vm.state.oi !== -1" type="button" class="btn btn-primary pull-right" ng-disabled="vm.ontologyForm.$invalid" ng-click="vm.submitEdit(vm.ontologyForm.$valid)"><i class="fa fa-floppy-o"></i> Save</button>
                            <button ng-if="vm.state.oi === -1" type="button" class="btn btn-primary pull-right" ng-disabled="vm.ontologyForm.$invalid" ng-click="vm.submitCreate(vm.ontologyForm.$valid)"><i class="fa fa-plus-circle"></i> Create</button>
                        </div>
                    </div>

                    <!-- annotations tab -->
                    <div ng-show="vm.state.editorTab === 'annotations'" class="tab clearfix">
                        <div ng-include="'annotations-template'"></div>
                    </div>

                    <!-- prefix tab -->
                    <div ng-show="vm.state.editorTab === 'prefix'" class="tab clearfix">
                        <!-- prefixes -->
                        <table class="table table-bordered input-table">
                            <thead>
                                <tr>
                                    <th class="prefix-col">Prefix</th>
                                    <th>Value</th>
                                    <th class="action-button"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in vm.selected.matonto.context track by $index">
                                    <td>
                                        <input id="prefix-{{$index}}" type="text" value="{{item.key}}" ng-readonly="!editKey" />
                                        <button type="button" class="btn btn-link edit" ng-click="vm.editPrefix(editKey, item.key, $index); editKey = !editKey;">
                                            <i class="fa fa-pencil" ng-class="{'fa-pencil': !editKey, 'fa-floppy-o': editKey}"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <input id="value-{{$index}}" type="text" value="{{item.value}}" ng-readonly="!editValue" />
                                        <button type="button" class="btn btn-link edit" ng-click="vm.editValue(editValue, item.key, item.value, $index); editValue = !editValue;">
                                            <i class="fa fa-pencil" ng-class="{'fa-pencil': !editValue, 'fa-floppy-o': editValue}"></i>
                                        </button>
                                    </td>
                                    <td class="action-button">
                                        <button type="button" class="btn btn-link remove" ng-click="vm.removePrefix(item.key)"><i class="fa fa-minus"></i></button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <input type="text" ng-model="vm.key" placeholder="Enter new prefix..." ng-change="vm.showDuplicateMessage = false;" />
                                    </td>
                                    <td>
                                        <input type="text" ng-model="vm.value" placeholder="Enter new value..." ng-change="vm.showDuplicateMessage = false;" />
                                    </td>
                                    <td class="action-button">
                                        <button type="button" class="btn btn-link add" ng-disabled="!vm.key || !vm.value" ng-click="vm.addPrefix(vm.key, vm.value);"><i class="fa fa-plus"></i></button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- error messages for empty or unique -->
                        <div class="has-warning clearfix" ng-if="vm.showDuplicateMessage">
                            <strong ng-if="vm.showDuplicateMessage" class="help-block">Both prefix and value must be unique.</strong>
                        </div>
                    </div>
                </form>

                <!-- class editor -->
                <form name="vm.classForm" class="clearfix" novalidate autocomplete="off"
                      ng-if="vm.state.editor === 'class-editor'">

                    <!-- class editor tabs -->
                    <div class="btn-group btn-group-justified" role="group">
                        <a class="btn btn-primary"
                           ng-class="{'active': vm.state.editorTab === 'basic'}"
                           ng-click="vm.setEditorTab('basic');"><small>{{vm.state.ci !== -1 ? (vm.selected[vm.rdfs + 'label'][0]['@value'] || ((vm.selected['@id'] | splitIRI).end | beautify)) : 'New Class'}}</small></a>
                        <a class="btn btn-primary"
                           ng-class="{'active': vm.state.editorTab === 'annotations'}"
                           ng-click="vm.setEditorTab('annotations');"><small>Annotations</small></a>
                    </div>

                    <!-- basic tab -->
                    <div ng-show="vm.state.editorTab === 'basic'" class="tab clearfix">
                        <!-- warning message -->
                        <p ng-show="vm.selected.matonto.unsaved" class="text-warning"><i class="fa fa-exclamation-triangle fa-fw"></i>Not saved</p>

                        <!-- static iri -->
                        <p>
                            <strong><small class="text-muted">{{vm.selected['@id'] ? vm.selected['@id'] : (vm.selected.matonto.namespace + (vm.selected[vm.rdfs + 'label'][0]['@value'] | camelCase:'class'))}} <a ng-click="vm.iriType = 'class'; vm.showIriOverlay = true;">Advanced Options</a></small></strong>
                        </p>

                        <!-- rdfs:label -->
                        <div class="form-group">
                            <label class="control-label" for="class-name">Label <small class="text-muted">&lt;{{vm.rdfs}}label&gt;</small></label>
                            <input type="text" class="form-control" id="class-name" name="name" ng-model="vm.selected[vm.rdfs + 'label'][0]['@value']" ng-trim="false" ng-change="vm.selected.matonto.unsaved = true;">
                        </div>

                        <!-- rdfs:subClassOf -->
                        <div class="form-group">
                            <label class="control-label">Sub Class Of <small class="text-muted">&lt;{{vm.rdfs}}subClassOf&gt;</small></label>
                            <ui-select multiple ng-model="vm.selected[vm.rdfs + 'subClassOf']">
                                <ui-select-match placeholder="Select Class">
                                    <span title="{{$item['@id'] || vm.getItemIri($item)}}">{{$item['@id'] ? ($item['@id'] | splitIRI).end : $item.localName}}</span>
                                </ui-select-match>
                                <ui-select-choices group-by="vm.getItemNamespace" repeat="class in vm.ontology.matonto.subClasses | removeIriFromArray:vm.selected['@id'] | filter: $select.search">
                                    <div ng-bind-html="class.localName | highlight: $select.search | trusted"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>

                        <!-- rdfs:comment -->
                        <div class="form-group">
                            <label class="control-label" for="class-comments">Comment <small class="text-muted">&lt;{{vm.rdfs}}comment&gt;</small></label>
                            <textarea class="form-control" id="class-comments" name="comments" ng-model="vm.selected[vm.rdfs + 'comment'][0]['@value']" ng-change="vm.selected.matonto.unsaved = true;"></textarea>
                        </div>

                        <!-- buttons -->
                        <div ng-show="ontology.classes[vm.state.ci].tab !== 'annotations'" class="btn-container clearfix">
                            <button ng-if="vm.state.ci !== -1" type="button" class="btn btn-primary pull-right" ng-disabled="vm.classForm.$invalid" ng-click="vm.submitEdit(vm.classForm.$valid)"><i class="fa fa-floppy-o"></i> Save</button>
                            <button ng-if="vm.state.ci === -1" type="button" class="btn btn-primary pull-right" ng-disabled="vm.classForm.$invalid" ng-click="vm.submitCreate(vm.classForm.$valid)"><i class="fa fa-plus-circle"></i> Create</button>
                        </div>
                    </div>

                    <!-- annotations tab -->
                    <div ng-show="vm.state.editorTab === 'annotations'" class="tab clearfix">
                        <div ng-include="'annotations-template'"></div>
                    </div>
                </form>

                <!-- property editor -->
                <form name="vm.propertyForm" class="clearfix" novalidate autocomplete="off"
                      ng-if="vm.state.editor === 'property-editor'">

                    <!-- property editor tabs -->
                    <div class="btn-group btn-group-justified" role="group">
                        <a class="btn btn-primary"
                           ng-class="{'active': vm.state.editorTab === 'basic'}"
                           ng-click="vm.setEditorTab('basic');"><small>{{vm.selected['@id'] ? (vm.selected[vm.rdfs + 'label'][0]['@value'] || vm.selected['@id']) : 'New Property'}}</small></a>
                        <a class="btn btn-primary"
                           ng-class="{'active': vm.state.editorTab === 'annotations'}"
                           ng-click="vm.setEditorTab('annotations');"><small>Annotations</small></a>
                    </div>

                    <!-- basic tab -->
                    <div ng-show="vm.state.editorTab === 'basic'" class="tab clearfix">
                        <!-- warning message -->
                        <p ng-show="vm.selected.matonto.unsaved" class="text-warning"><i class="fa fa-exclamation-triangle fa-fw"></i>Not saved</p>

                        <!-- static iri -->
                        <p>
                            <strong><small class="text-muted">{{vm.selected['@id'] ? vm.selected['@id'] : (vm.selected.matonto.namespace + (vm.selected[vm.rdfs + 'label'][0]['@value'] | camelCase:'property'))}} <a ng-click="vm.iriType = 'property'; vm.showIriOverlay = true;">Advanced Options</a></small></strong>
                        </p>

                        <!-- rdfs:label -->
                        <div class="form-group">
                            <label class="control-label" for="property-name">Label <small class="text-muted">&lt;{{vm.rdfs}}label&gt;</small></label>
                            <input type="text" class="form-control" id="property-name" name="name" ng-model="vm.selected[vm.rdfs + 'label'][0]['@value']" ng-change="vm.selected.matonto.unsaved = true;">
                        </div>

                        <!-- http://www.w3.org/1999/02/22-rdf-syntax-ns#type(s) -->
                        <div class="form-group">
                            <label class="control-label">Type <small class="text-muted">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;</small></label>
                            <p class="form-control-static"><span ng-repeat="type in vm.selected['@type']">{{type}}{{$last ? '' : ', '}}</span></p>
                        </div>

                        <!-- rdfs:subPropertyOf -->
                        <div ng-if="vm.isObjectProperty()" class="form-group">
                            <label class="control-label">Sub Property Of <small class="text-muted">&lt;{{vm.rdfs}}subPropertyOf&gt;</small></label>
                            <ui-select multiple ng-model="vm.selected[vm.rdfs + 'subPropertyOf']">
                                <ui-select-match placeholder="Select Property">
                                    <span title="{{$item['@id'] || vm.getItemIri($item)}}">{{$item['@id'] ? ($item['@id'] | splitIRI).end : $item.localName}}</span>
                                </ui-select-match>
                                <ui-select-choices group-by="vm.getItemNamespace" repeat="property in vm.ontology.matonto.subObjectProperties | filter: $select.search">
                                    <div ng-bind-html="property.localName | highlight: $select.search | trusted"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>

                        <div ng-if="!vm.isObjectProperty()" class="form-group">
                            <label class="control-label">Sub Property Of <small class="text-muted">&lt;{{vm.rdfs}}subPropertyOf&gt;</small></label>
                            <ui-select multiple ng-model="vm.selected[vm.rdfs + 'subPropertyOf']">
                                <ui-select-match placeholder="Select Property">
                                    <span title="{{$item['@id'] || vm.getItemIri($item)}}">{{$item['@id'] ? ($item['@id'] | splitIRI).end : $item.localName}}</span>
                                </ui-select-match>
                                <ui-select-choices group-by="vm.getItemNamespace" repeat="property in vm.ontology.matonto.subDataProperties | filter: $select.search">
                                    <div ng-bind-html="property.localName | highlight: $select.search | trusted"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>

                        <!-- rdfs:domain -->
                        <div class="form-group">
                            <label class="control-label">Domain <small class="text-muted">&lt;{{vm.rdfs}}domain&gt;</small></label>
                            <ui-select multiple ng-model="vm.selected[rdfs + 'domain']">
                                <ui-select-match placeholder="Select Domain">
                                    <span title="{{$item['@id'] || vm.getItemIri($item)}}">{{$item['@id'] ? ($item['@id'] | splitIRI).end : $item.localName}}</span>
                                </ui-select-match>
                                <ui-select-choices group-by="vm.getItemNamespace" repeat="class in vm.ontology.matonto.subClasses | filter:{'localName':$select.search}">
                                    <div ng-bind-html="class.localName | highlight:$select.search | trusted"></div>
                                </ui-select-choices>
                            </ui-select>
                        </div>

                        <!-- rdfs:range -->
                        <div class="form-group">
                            <label class="control-label">Range <small class="text-muted">&lt;{{vm.rdfs}}range&gt;</small></label>
                        </div>

                        <!-- rdfs:comment -->
                        <div class="form-group">
                            <label class="control-label" for="property-comments">Comment <small class="text-muted">&lt;{{vm.rdfs}}comment&gt;</small></label>
                            <textarea class="form-control" id="property-comments" name="comments" ng-model="vm.selected[vm.rdfs + 'comment'][0]['@value']" ng-change="vm.selected.matonto.unsaved = true;"></textarea>
                        </div>

                        <!-- buttons -->
                        <div class="btn-container clearfix">
                            <button ng-if="vm.state.pi !== -1" type="button" class="btn btn-primary pull-right" ng-disabled="vm.propertyForm.$invalid" ng-click="vm.submitEdit(vm.propertyForm.$valid)"><i class="fa fa-floppy-o"></i> Save</button>
                            <button ng-if="vm.state.pi === -1" type="button" class="btn btn-primary pull-right" ng-disabled="vm.propertyForm.$invalid" ng-click="vm.submitCreate(vm.propertyForm.$valid)"><i class="fa fa-plus-circle"></i> Create</button>
                        </div>
                    </div>

                    <!-- annotations tab -->
                    <div ng-show="vm.state.editorTab === 'annotations'" class="tab clearfix">
                        <div ng-include="'annotations-template'"></div>
                    </div>
                </form>

                <!-- iri editor overlay -->
                <div class="overlay" ng-if="vm.showIriOverlay"
                     ng-init="iri = (vm.selected.matonto.namespace ? (vm.selected.matonto.namespace + vm.selected['@id']) : vm.selected['@id'] | splitIRI);
                              vm.iriBegin = iri.begin;
                              vm.iriThen = iri.then;
                              vm.iriEnd = iri.end || (vm.selected[vm.rdfs + 'label'][0]['@value'] | camelCase:vm.iriType);
                              vm.iriUpdate = true;">
                    <form name="vm.iriForm" class="content clearfix" novalidate autocomplete="off"
                          ng-submit="vm.editIRI();">
                        <!-- section header -->
                        <h6>Edit IRI</h6>
                        <!-- Begins with -->
                        <div ng-class="{'has-error': vm.iriForm.iriBegin.$invalid}" class="form-group">
                            <label class="control-label" for="iriBegin">Begins with</label>
                            <input class="form-control" id="iriBegin" name="iriBegin" ng-model="vm.iriBegin" ng-pattern="/^[^:\/?#]+:\/\/[^\/?#]*[^#\s]*[^#:\/\s]$/" required />
                            <!--p class="error-msg" ng-if="vm.iriForm.iriBegin.$invalid">This IRI is invalid.</p-->
                        </div>
                        <!-- Then -->
                        <div class="form-group">
                            <label class="control-label" for="iriThen">Then</label>
                            <select class="form-control" id="iriThen" name="iriThen" ng-model="vm.iriThen">
                                <option value="#">#</option>
                                <option value="/">/</option>
                                <option value=":">:</option>
                            </select>
                        </div>
                        <!-- Ends with -->
                        <div ng-class="{'has-error': vm.iriForm.iriEnd.$invalid}" class="form-group">
                            <label class="control-label" for="iriEnd">Ends with</label>
                            <input class="form-control" id="iriEnd" name="iriEnd" ng-pattern="/^[a-zA-Z0-9-_]+$/" required ng-model="vm.iriEnd" ng-trim="false" />
                            <!--p class="error-msg" ng-if="vm.iriForm.iriEnd.$invalid">This localname is invalid.</p-->
                        </div>
                        <!-- Update references -->
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" id="iriUpdate" ng-model="vm.iriUpdate" /> Update all entities that referenced this IRI.
                            </label>
                        </div>
                        <!-- buttons -->
                        <div class="btn-container clearfix">
                            <button type="submit" class="btn btn-primary pull-right" ng-disabled="vm.iriForm.$invalid"><i class="fa fa-pencil fa-fw"></i>Edit</button>
                            <button type="button" class="btn btn-default pull-right" ng-click="vm.showIriOverlay = false;">Cancel</button>
                        </div>
                    </form>
                </div>

                <!-- upload ontology overlay -->
                <div class="overlay sm" ng-if="vm.showUploadOverlay">
                    <form name="vm.uploadForm" class="content clearfix" novalidate autocomplete="off"
                          ng-submit="vm.uploadOntology(vm.uploadForm.$valid, vm.upload.file, vm.upload.namespace, vm.upload.localName);">
                        <!-- section header -->
                        <h6>Upload Ontology</h6>
                        <p class="text-danger" ng-show="vm.uploadError">
                            <i class="fa fa-exclamation-triangle fa-fw"></i>{{vm.uploadError}}
                        </p>
                        <!-- file to upload -->
                        <div class="form-group">
                            <label for="file">Select a file</label>
                            <div id="file" name="file" file-input="vm.upload.file"></div>
                        </div>
                        <!-- buttons -->
                        <div class="btn-container clearfix">
                            <button type="submit" class="btn btn-primary pull-right" ng-disabled="!vm.upload.file" ng-click="vm.uploadError = false;"><i class="fa fa-upload fa-fw"></i>Upload It</button>
                            <button type="button" class="btn btn-default pull-right" ng-click="vm.showUploadOverlay = false; vm.uploadError = false;">Cancel</button>
                        </div>
                    </form>
                </div>

                <!-- annotation overlay -->
                <div class="overlay" ng-if="vm.showAnnotationOverlay">
                    <form name="vm.annotationForm" class="content clearfix" novalidate autocomplete="off">
                        <div ng-if="!vm.editingAnnotation">
                            <!-- section header -->
                            <h6>Add Annotation</h6>

                            <!-- annotation list -->
                            <div class="form-group">
                                <label class="control-label">Annotation</label>
                                <ui-select ng-model="vm.selected.matonto.currentAnnotationSelect">
                                    <ui-select-match placeholder="Select an annotation">{{vm.getItemIri($select.selected)}}</ui-select-match>
                                    <ui-select-choices group-by="vm.getItemNamespace" repeat="annotation in vm.ontology.matonto.annotations | filter: $select.search">
                                        <div ng-bind-html="annotation.localName | highlight: $select.search | trusted"></div>
                                    </ui-select-choices>
                                </ui-select>
                            </div>

                            <!-- key, if new -->
                            <div ng-if="vm.selected.matonto.currentAnnotationSelect.localName === 'New Annotation'" class="form-group">
                                <label class="control-label" for="ontology-annotation-key">Name <small class="text-muted">*Must be a valid IRI or you won't be able to add it.</small></label>
                                <input type="text" class="form-control" id="ontology-annotation-key" name="annotation-key" ng-model="vm.selected.matonto.currentAnnotationKey" ng-pattern="vm.getPattern()" required />
                            </div>
                        </div>

                        <div ng-if="vm.editingAnnotation">
                            <!-- section header -->
                            <h6>Edit Annotation</h6>

                            <!-- static text showing which annotation you are editing -->
                            <div ng-if="vm.editingAnnotation" class="form-group">
                                <label class="control-label">Name</label>
                                <p class="form-control-static">{{vm.selected.matonto.currentAnnotationKey}}</p>
                            </div>
                        </div>

                        <!-- value -->
                        <div class="form-group">
                            <label class="control-label" for="ontology-annotation-value">Value</label>
                            <textarea class="form-control" id="ontology-annotation-value" name="annotation-value" ng-model="vm.selected.matonto.currentAnnotationValue" required></textarea>
                        </div>

                        <!-- TODO: add a section here for comments -->
                        <!-- annotation buttons -->
                        <div class="btn-container clearfix">
                            <!-- adding a custom one -->
                            <button ng-if="!vm.editingAnnotation" type="button" class="btn btn-primary pull-right"
                                    ng-disabled="vm.annotationForm.$invalid || vm.selected.matonto.currentAnnotationSelect === 'default'"
                                    ng-click="vm.addAnnotation();">Add</button>

                            <button ng-if="vm.editingAnnotation" type="button" class="btn btn-primary pull-right"
                                    ng-disabled="vm.annotationForm.$invalid"
                                    ng-click="vm.editAnnotation();">Edit</button>

                            <button type="button" class="btn btn-default pull-right" ng-click="vm.showAnnotationOverlay = false;">Cancel</button>
                        </div>
                    </form>
                </div>

            </div>
        </section>
    </div>
</div>

<!-- annotation template -->
<script type="text/ng-template" id="annotations-template">
    <!-- add annotation button -->
    <a class="btn btn-link btn-annotation" ng-click="vm.editingAnnotation = false; vm.showAnnotationOverlay = true;"><i class="fa fa-fw fa-plus"></i>Add Annotation</a>

    <!-- list of annotations -->
    <div class="annotation" ng-repeat="key in (vm.selected | showAnnotations:vm.ontology.matonto.annotations) track by $index">
        <h5 title="{{key}}">{{(key | splitIRI).end | beautify}}</h5>
        <div class="value-container" ng-repeat="value in vm.selected[key]">
            <p>{{value['@value']}}</p>
            <button type="button" class="btn btn-link btn-edit" ng-click="vm.editClicked(key, $index);" title="Edit"><i class="fa fa-pencil"></i></button>
            <button type="button" class="btn btn-link btn-delete" ng-click="vm.removeAnnotation(key, $index)" title="Delete"><i class="fa fa-times"></i></button>
        </div>
    </div>
</script>
