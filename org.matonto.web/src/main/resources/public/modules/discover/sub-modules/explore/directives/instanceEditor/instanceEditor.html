<!--
  #%L
  org.matonto.web
  $Id:$
  $HeadURL:$
  %%
  Copyright (C) 2016 - 2017 iNovex Information Systems, Inc.
  %%
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
  
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
  
  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
  #L%
  -->
<div class="instance-editor">
    <block>
        <block-header>
            <breadcrumbs class="pull-left" items="dvm.ds.explore.breadcrumbs" on-click="dvm.ds.clickCrumb(index)"></breadcrumbs>
            <a class="pull-right link" ng-click="dvm.cancel()">Cancel</a>
            <a class="pull-right link" ng-click="dvm.save()"><i class="fa fa-floppy-o"></i>Save</a>
        </block-header>
        <block-content>
            <div class="row">
                <div class="col-xs-8 col-xs-offset-2">
                    <h2>Instance Editor</h2>
                    <static-iri iri="dvm.ds.explore.instance.entity['@id']" on-edit="dvm.setIRI(iriBegin, iriThen, iriEnd)">
                        <info-message>Changing this IRI might break relationships within the dataset.</info-message>
                    </static-iri>
                    <form name="dvm.form" autocomplete="off" name="dvm.form">
                        <div class="form-group" ng-repeat="(key, value) in dvm.ds.explore.instance.entity track by $index" ng-if="key !== '@id' && key !== '@type'">
                            <custom-label ng-class="{'changed': dvm.isChanged(key)}">{{dvm.util.getBeautifulIRI(key)}}</custom-label>
                            <div class="boolean-property" ng-if="dvm.isBoolean(key)">
                                <md-checkbox ng-model="dvm.ds.explore.instance.entity[key][0]['@value']" ng-true-value="'1'" ng-false-value="'0'" ng-change="dvm.addToChanged(key)" aria-label="{{dvm.util.getBeautifulIRI(key)}}"></md-checkbox>
                            </div>
                            <md-chips class="data-property" ng-if="dvm.isPropertyOfType(key, 'Data') && !dvm.isBoolean(key)" ng-model="dvm.ds.explore.instance.entity[key]" md-transform-chip="dvm.createValueObj($chip, key)" md-on-add="dvm.addToChanged(key)" md-on-remove="dvm.addToChanged(key)" md-on-select="dvm.onSelect($chip)">
                                <input type="{{dvm.getInputType(key)}}" ng-pattern="dvm.getPattern(key)" placeholder="Enter value...">
                                <md-chip-template>{{$chip['@value']}}</md-chip-template>
                            </md-chips>
                            <md-chips class="object-property" ng-if="dvm.isPropertyOfType(key, 'Object')" ng-model="dvm.ds.explore.instance.entity[key]" md-transform-chip="dvm.createIdObj($chip)" md-on-add="dvm.addToChanged(key)" md-on-remove="dvm.addToChanged(key)" md-on-select="dvm.onSelect($chip)">
                                <md-autocomplete md-input-name="{{key}}" md-items="iri in dvm.getOptions(key)" placeholder="Enter IRI..." ng-pattern="dvm.regex.IRI" md-search-text="dvm.searchText[key]" md-no-cache="true">
                                    <span md-highlight-text="dvm.searchText[key]">{{dvm.util.getBeautifulIRI(iri)}} :: {{iri}}</span>
                                </md-autocomplete>
                                <md-chip-template>{{$chip['@id']}}</md-chip-template>
                            </md-chips>
                        </div>
                    </form>
                    <div class="btn-container clearfix">
                        <button type="button" ng-disabled="!dvm.getNewProperties().length" ng-click="dvm.showOverlay = true" class="btn btn-link pull-left"><i class="fa fa-plus fa-fw"></i>Add New Property</button>
                    </div>
                </div>
            </div>
        </block-content>
    </block>
    <new-instance-property-overlay ng-if="dvm.showOverlay" on-cancel="dvm.showOverlay = false" on-submit="dvm.addNewProperty(propertyIRI)" get-properties="dvm.getNewProperties(text)"></new-instance-property-overlay>
    <confirmation-overlay ng-if="dvm.showText" cancel-click="dvm.showText = false" cancel-text="'Close'" header-text="'Complete Value'">
        <p>{{dvm.fullText}}</p>
    </confirmation-overlay>
</div>